# 📘 1. 基本設計書
**プロジェクト名**: Cross Stage（クロスステージ）
**バージョン**: 1.0.0

---

## 1.1 システム概要
**「音楽と身体が交差する、次世代Webリズムアクション」**

本システムは、**TextAlive App API** による楽曲解析技術と、**MediaPipe Pose** による身体検知AIを融合させた、Webブラウザ完結型のリズムゲームです。
専用デバイスを必要とせず、PCやスマートフォンのカメラだけで全身を使った没入型体験を提供します。

---

## 1.2 技術スタック (Tech Stack)

| カテゴリ | 技術・ライブラリ | バージョン | 役割 |
| :--- | :--- | :--- | :--- |
| **Frontend** | React | 18.2 | UI構築、コンポーネント管理 |
| | Vite | 5.1 | ビルドツール、HMR |
| | TypeScript | 5.2 | 型安全性確保 |
| **Visual / AI** | Three.js | 0.161 | 3Dステージ演出、アバター描画 |
| | MediaPipe Pose | (WASM) | リアルタイム骨格検知 |
| | TextAlive App API | 0.3 | 楽曲再生、歌詞同期データ取得 |
| **Backend** | Cloudflare Workers | - | サーバーレスAPI (Honoフレームワーク) |
| | Durable Objects | - | レート制限、整合性管理 |
| **Database** | Supabase | - | スコアデータ永続化 (PostgreSQL) |
| **Security** | Turnstile | - | Bot対策、CAPTCHA認証 |

---

## 1.3 機能要件一覧

### 🎮 ゲームプレイ機能
- **楽曲再生・同期**: TextAliveにより、楽曲のビートやサビ情報をリアルタイムに取得。
- **歌詞バブル表示**: 音楽に合わせて歌詞がバブルとして出現。CSSアニメーションで制御。
- **3モード対応**:
    1. **Cursor Mode**: マウス/タッチ操作。
    2. **Mobile Mode**: スマホ向け軽量UI。タップ＆ホールド操作。
    3. **Body Mode**: Webカメラ使用。全身の動きで操作。

### 🏆 スコア・ランキング機能
- **リアルタイムスコア**: プレイ中のコンボ数、スコア計算、ランク判定（SS/S/A...）。
- **スコア送信**: プレイ終了後、プレイヤー名とともにスコアをサーバーへ送信。
- **ランキング表示**: 全期間/週間/24時間別のランキング閲覧。

### 🛡️ セキュリティ機能
- **署名検証**: HMAC SHA-256によるAPIリクエスト署名。
- **レート制限**: 短時間の大量アクセスを遮断。
- **不正検知**: 理論値を超えるスコアの自動フラグ付け。