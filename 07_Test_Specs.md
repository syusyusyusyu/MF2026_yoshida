# 🧪 7. テスト仕様書

## 7.1 単体テスト (Unit Tests)

### ✅ GameManager ロジック検証
| ID | テスト項目 | 前提条件 | 入力値 | 期待される結果 |
| :--- | :--- | :--- | :--- | :--- |
| UT-01 | スコア加算 | ホールド中 | 進行度 1.0 (100%) | `score` が規定点数分加算されること。 |
| UT-02 | コンボリセット | プレイ中 | 30秒間入力なし | `combo` が 0 にリセットされること。 |
| UT-03 | 歌詞同期 | 再生中 | シーク操作 (時間飛躍) | `syncLyricIndexToPosition` が発火し、歌詞位置が修正されること。 |

### ✅ API バリデーション (Worker)
| ID | テスト項目 | 前提条件 | 入力値 | 期待される結果 |
| :--- | :--- | :--- | :--- | :--- |
| UT-04 | スコア上限チェック | - | score: 1,000,001 | 成功するが、DBの `is_suspicious` が `true` になること。 |
| UT-05 | プレイヤー名検証 | - | name: (空文字) | ステータス `400 Bad Request` が返ること。 |

---

## 7.2 結合テスト (Integration Tests)

### 🚀 シナリオ: Body Mode プレイフロー
1. **初期化**: カメラ権限を許可し、`BodyDetectionManager` が全身検知を開始する。
    - 👉 *確認*: カウントダウンオーバーレイが表示されること。
2. **プレイ**: 楽曲再生中、手首の座標を動かす。
    - 👉 *確認*: `handlePoseResults` によりバブルが反応し、スコアが入ること。
3. **終了**: 楽曲終了 (`onFinish`)。
    - 👉 *確認*: リザルト画面が表示され、`ResultsManager` が起動すること。
4. **送信**: スコア登録ボタン押下。
    - 👉 *確認*: `POST /api/score` が成功し、ランキングパネルに即座に反映されること。

### 🛡️ シナリオ: セキュリティ・レート制限
1. **連続送信**: スクリプト等でスコア送信APIを短時間に連打する。
    - 👉 *確認*: 1分間に10回を超えた時点で、HTTPステータス `429 Too Many Requests` が返却されること。